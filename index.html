<!DOCTYPE html>
<html lang="vi" class="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ứng dụng Thần Số Học</title>
  <link href="https://unpkg.com/tailwindcss@^2/dist/tailwind.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      transition: background 0.3s ease, color 0.3s ease;
      overflow-x: hidden;
    }
    .light {
      background: linear-gradient(135deg, #d8b4fe, #e9d5ff);
    }
    .dark {
      background: linear-gradient(135deg, #1e3a8a, #4c1d95);
      color: #ffffff;
    }
    .header-container {
      position: relative;
      display: flex;
      justify-content: center;
      align-items: center;
      margin-bottom: 2rem;
    }
    #themeToggle {
      position: absolute;
      right: 0;
      transition: transform 0.3s ease;
    }
    #themeToggle:hover {
      transform: rotate(180deg);
    }
    .input-field, .select-field {
      transition: all 0.3s ease;
      color: #000000;
      min-width: 120px;
      border-radius: 0.5rem;
      padding: 1rem;
      font-size: 1.1rem;
    }
    .input-field:focus, .select-field:focus {
      border-color: #a855f7;
      box-shadow: 0 0 0 3px rgba(168, 85, 247, 0.2);
    }
    .dark .input-field, .dark .select-field {
      color: #ffffff;
      background-color: #2d3748;
    }
    .dark .input-field::placeholder, .dark .select-field::placeholder {
      color: #d1d5db;
    }
    .btn-calculate, #clearBtn {
      transition: transform 0.3s ease, background-color 0.3s ease;
      border-radius: 0.75rem;
      padding: 1.25rem 2rem;
      font-size: 1.25rem;
      font-weight: 600;
      width: auto;
      min-width: 150px;
      text-align: center;
    }
    .btn-calculate {
      background-color: #a855f7;
      color: #ffffff;
    }
    .btn-calculate:hover {
      background-color: #9333ea;
      transform: scale(1.05);
    }
    #clearBtn {
      background-color: #6b7280;
      color: #ffffff;
    }
    #clearBtn:hover {
      background-color: #4b5563;
      transform: scale(1.05);
    }
    .result-card {
      background: linear-gradient(145deg, #ffffff, #f3e8ff);
      transition: transform 0.3s ease, opacity 0.3s ease;
      padding: 1.5rem;
      max-height: 400px;
      overflow-y: auto;
      border-radius: 0.75rem;
      animation: fadeIn 0.5s ease-in-out;
    }
    .dark .result-card {
      background: linear-gradient(145deg, #2d3748, #4a5568);
      color: #edf2f7;
    }
    .result-card:hover {
      transform: translateY(-5px);
    }
    .toggle-btn {
      transition: background-color 0.3s ease;
    }
    .dark .toggle-btn {
      background-color: #4b0082;
    }
    .light .text-gray-800 {
      color: #111827;
    }
    #result {
      font-size: 1rem;
      line-height: 1.6;
    }
    #details p, #meanings p, #calculationDetails p {
      line-height: 1.6;
      font-size: 1rem;
    }
    .details-hidden {
      max-height: 0;
      overflow: hidden;
      opacity: 0;
      transition: max-height 0.5s ease, opacity 0.3s ease;
    }
    .details-shown {
      max-height: 1000px;
      opacity: 1;
      transition: max-height 0.5s ease, opacity 0.3s ease;
    }
    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      display: none;
    }
    .loading-overlay.active {
      display: flex;
    }
    .spinner {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #a855f7;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .button-line {
      display: flex;
      flex-wrap: nowrap;
      gap: 1rem;
      width: 100%;
      justify-content: center;
    }
    [data-tooltip] {
      position: relative;
    }
    [data-tooltip]:hover::after {
      content: attr(data-tooltip);
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      background-color: #333;
      color: #fff;
      padding: 0.5rem;
      border-radius: 0.25rem;
      font-size: 0.9rem;
      white-space: nowrap;
      z-index: 10;
      margin-bottom: 0.5rem;
    }
    @media (max-width: 640px) {
      .result-card {
        padding: 1rem;
      }
      #result {
        font-size: 0.9rem;
      }
      .button-line {
        flex-direction: row;
        gap: 0.5rem;
      }
      .input-field, .select-field {
        font-size: 1rem;
        padding: 0.75rem;
      }
      .btn-calculate, #clearBtn {
        font-size: 1rem;
        padding: 1rem 1.5rem;
        min-width: 120px;
      }
      h1 {
        font-size: 1.5rem;
      }
      h2 {
        font-size: 1.125rem;
      }
    }
    @media (min-width: 640px) {
      h1 {
        font-size: 2rem;
      }
      h2 {
        font-size: 1.5rem;
      }
      #result {
        font-size: 1rem;
      }
      .button-line {
        gap: 1rem;
      }
    }
  </style>
</head>
<body class="flex items-center justify-center min-h-screen">
  <div id="loadingOverlay" class="loading-overlay">
    <div class="spinner"></div>
  </div>
  <div class="bg-white dark:bg-gray-800 bg-opacity-90 dark:bg-opacity-90 p-8 rounded-2xl shadow-2xl w-full max-w-2xl mx-4">
    <div class="header-container mb-8">
      <h1 class="text-2xl sm:text-4xl font-bold text-center text-purple-800 dark:text-purple-300 animate-pulse">Thần Số Học - Khám Phá Bản Thân</h1>
      <button id="themeToggle" class="toggle-btn bg-purple-600 dark:bg-purple-900 text-white p-2 rounded-full focus:outline-none">
        <svg id="themeIcon" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
        </svg>
      </button>
    </div>
    <div class="space-y-6">
      <div>
        <label class="block text-lg font-medium text-gray-700 dark:text-gray-300 mb-2">Họ và tên đầy đủ</label>
        <input type="text" id="fullName" placeholder="Nhập họ và tên" class="input-field block w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none dark:bg-gray-700 dark:text-white" data-tooltip="Vui lòng nhập họ và tên đầy đủ của bạn">
      </div>
      <div>
        <label class="block text-lg font-medium text-gray-700 dark:text-gray-300 mb-2">Ngày sinh</label>
        <div class="flex space-x-3 flex-wrap gap-4">
          <select id="day" class="select-field block w-1/3 p-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none dark:bg-gray-700 dark:text-white" data-tooltip="Chọn ngày sinh của bạn">
            <option value="" disabled selected>Ngày</option>
          </select>
          <select id="month" class="select-field block w-1/3 p-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none dark:bg-gray-700 dark:text-white" data-tooltip="Chọn tháng sinh của bạn">
            <option value="" disabled selected>Tháng</option>
          </select>
          <input type="number" id="year" placeholder="Năm" min="1900" max="2025" maxlength="4" class="input-field block w-1/3 p-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none dark:bg-gray-700 dark:text-white" data-tooltip="Nhập năm sinh (4 chữ số, từ 1900 đến 2025)">
        </div>
      </div>
      <div class="button-line">
        <button id="calculateBtn" class="btn-calculate bg-purple-600 text-white p-3 rounded-lg font-semibold flex items-center justify-center" data-tooltip="Nhấn để tính số học của bạn">
          Tính Toán
        </button>
        <button id="clearBtn" class="bg-gray-400 text-white p-3 rounded-lg font-semibold hover:bg-gray-500 transition-colors" data-tooltip="Nhấn để xóa tất cả thông tin đã nhập">
          Xóa
        </button>
      </div>
    </div>
    <div id="result" class="mt-6 text-gray-800 dark:text-gray-100 space-y-4">
      <div id="summary" class="result-card p-4 rounded-lg shadow-md"></div>
      <button id="showMoreBtn" class="w-full bg-purple-600 text-white p-2 rounded-lg font-semibold mt-2 hidden" data-tooltip="Nhấn để xem chi tiết kết quả">Xem Thêm</button>
      <button id="showCalcBtn" class="w-full bg-purple-600 text-white p-2 rounded-lg font-semibold mt-2 hidden" data-tooltip="Nhấn để xem cách tính">Xem Cách Tính</button>
      <button id="showMeaningsBtn" class="w-full bg-purple-600 text-white p-2 rounded-lg font-semibold mt-2 hidden" data-tooltip="Nhấn để xem ý nghĩa các con số">Xem Ý Nghĩa Các Con Số</button>
      <div id="details" class="details-hidden result-card p-4 rounded-lg shadow-md mt-4"></div>
      <div id="calculationDetails" class="details-hidden result-card p-4 rounded-lg shadow-md mt-4"></div>
      <div id="meanings" class="details-hidden result-card p-4 rounded-lg shadow-md mt-4"></div>
    </div>
  </div>
  <script>
    const CURRENT_YEAR = 2025;

    // Function to remove diacritical marks from Vietnamese text
    function normalizeName(text) {
      return text
        .normalize('NFD')
        .replace(/[\u0300-\u036f]/g, '')
        .replace(/đ/g, 'd')
        .replace(/Đ/g, 'D')
        .toLowerCase();
    }

    // Populate day and month dropdowns
    function populateDropdowns() {
      const daySelect = document.getElementById('day');
      const monthSelect = document.getElementById('month');
      for (let i = 1; i <= 31; i++) {
        const option = document.createElement('option');
        option.value = i;
        option.textContent = i;
        daySelect.appendChild(option);
      }
      for (let i = 1; i <= 12; i++) {
        const option = document.createElement('option');
        option.value = i;
        option.textContent = i;
        monthSelect.appendChild(option);
      }
    }

    // Restrict year input to 4 digits
    document.getElementById('year').addEventListener('input', function(e) {
      if (e.target.value.length > 4) {
        e.target.value = e.target.value.slice(0, 4);
      }
    });

    // Normalize input as user types
    document.getElementById('fullName').addEventListener('input', function(e) {
      const normalizedValue = normalizeName(e.target.value);
      e.target.value = normalizedValue;
    });

    function reduceToSingleDigit(number) {
      if (number === 11 || number === 22) return number;
      while (number > 9) number = String(number).split('').reduce((sum, digit) => sum + Number(digit), 0);
      return number;
    }

    function getLetterValue(letter) {
      const values = {'A':1,'B':2,'C':3,'D':4,'E':5,'F':6,'G':7,'H':8,'I':9,'J':1,'K':2,'L':3,'M':4,'N':5,'O':6,'P':7,'Q':8,'R':9,'S':1,'T':2,'U':3,'V':4,'W':5,'X':6,'Y':7,'Z':8};
      return values[letter.toUpperCase()] || 0;
    }

    function isVowel(letter, prevLetter, nextLetter) {
      letter = letter.toUpperCase();
      if (['A','E','I','O','U'].includes(letter)) return true;
      if (letter === 'Y') return !prevLetter || !nextLetter || !['A','E','I','O','U'].includes(prevLetter.toUpperCase()) && !['A','E','I','O','U'].includes(nextLetter?.toUpperCase());
      return false;
    }

    function getLifePathMeaning(number) {
      const meanings = {
        2: "Hợp tác, nhạy cảm, hòa hợp. <strong>Cơ hội:</strong> Xây dựng mối quan hệ vững chắc, hòa giải xung đột trong gia đình hoặc công việc. <strong>Thách thức:</strong> Dễ phụ thuộc vào người khác, né tránh xung đột dẫn đến tích tụ cảm xúc tiêu cực. <strong>Lời khuyên:</strong> Học cách đưa ra quyết định độc lập và bày tỏ ý kiến cá nhân.",
        5: "Tự do, phiêu lưu, linh hoạt. <strong>Cơ hội:</strong> Khám phá thế giới, du lịch, trải nghiệm mới mẻ trong công việc và cuộc sống. <strong>Thách thức:</strong> Bất ổn, thiếu cam kết dẫn đến mối quan hệ không bền vững. <strong>Lời khuyên:</strong> Đặt mục tiêu rõ ràng và cân bằng giữa tự do và trách nhiệm.",
        6: "Trách nhiệm, gia đình, yêu thương. <strong>Cơ hội:</strong> Hỗ trợ cộng đồng, xây dựng gia đình hạnh phúc, thành công trong lĩnh vực chăm sóc. <strong>Thách thức:</strong> Kiệt sức do gánh quá nhiều trách nhiệm, khó nói 'không'. <strong>Lời khuyên:</strong> Học cách ưu tiên bản thân và phân bổ thời gian hợp lý.",
        8: "Quyền lực, thành công, tài chính. <strong>Cơ hội:</strong> Thăng tiến sự nghiệp, đạt thành công tài chính lớn qua kinh doanh. <strong>Thách thức:</strong> Tham lam, mất cân bằng giữa công việc và cuộc sống. <strong>Lời khuyên:</strong> Dành thời gian thư giãn với gia đình và thực hành lòng biết ơn.",
        9: "Nhân đạo, hoàn thành, cống hiến. <strong>Cơ hội:</strong> Làm từ thiện, giúp đỡ người khác, hoàn thành sứ mệnh nhân sinh. <strong>Thách thức:</strong> Cảm xúc quá tải, khó buông bỏ quá khứ. <strong>Lời khuyên:</strong> Thực hành thiền hoặc viết nhật ký để giải tỏa cảm xúc."
      };
      return meanings[number] || "Không xác định";
    }

    function getChallengeMeaning(number) {
      const meanings = {
        0: "Thách thức số 0: Không có thách thức cụ thể, nhưng cần tập trung vào bài học của con số chủ đạo. Tìm sự cân bằng và phát triển toàn diện bản thân.",
        3: "Thách thức số 3: Tập trung và phát triển kỷ luật. Giảm phân tâm để hoàn thành mục tiêu dài hạn.",
        4: "Thách thức số 4: Ổn định nhưng thích nghi với thay đổi. Tránh cứng nhắc để đón nhận cơ hội mới."
      };
      return meanings[number] || "Không xác định";
    }

    function calculateAdditionalNumbers(fullName, day, month, year, lifePathNumber) {
      let expressionSum = 0, hiddenPassion = {}, challenge1 = 0, challenge2 = 0, challenge3 = 0, challenge4 = 0;
      const letters = fullName.split('');
      for (let i = 0; i < letters.length; i++) {
        const letter = letters[i];
        if (/[a-zA-Z]/.test(letter)) {
          const value = getLetterValue(letter);
          expressionSum += value;
          hiddenPassion[value] = (hiddenPassion[value] || 0) + 1;
        }
      }
      const expressionNumber = reduceToSingleDigit(expressionSum);
      const hiddenPassionNumber = Object.keys(hiddenPassion).reduce((a, b) => hiddenPassion[a] > hiddenPassion[b] ? a : b, 0);
      const birthDayNumber = reduceToSingleDigit(day);
      challenge1 = reduceToSingleDigit(Math.abs(lifePathNumber - birthDayNumber));
      challenge2 = reduceToSingleDigit(Math.abs(lifePathNumber - expressionNumber));
      challenge3 = reduceToSingleDigit(Math.abs(lifePathNumber - reduceToSingleDigit(month)));
      challenge4 = reduceToSingleDigit(Math.abs(lifePathNumber - reduceToSingleDigit(year)));
      return {expressionNumber, hiddenPassionNumber, birthDayNumber, challenge1, challenge2, challenge3, challenge4};
    }

    function isValidDate(day, month, year) {
      const date = new Date(year, month - 1, day);
      return date.getDate() === day && date.getMonth() === month - 1 && date.getFullYear() === year;
    }

    function saveInputs(fullName, day, month, year) {
      localStorage.setItem('numerologyInputs', JSON.stringify({ fullName, day, month, year }));
    }

    function loadInputs() {
      const inputs = JSON.parse(localStorage.getItem('numerologyInputs'));
      if (inputs) {
        document.getElementById('fullName').value = inputs.fullName || '';
        document.getElementById('day').value = inputs.day || '';
        document.getElementById('month').value = inputs.month || '';
        document.getElementById('year').value = inputs.year || '';
      }
    }

    function showLoading() {
      document.getElementById('loadingOverlay').classList.add('active');
    }

    function hideLoading() {
      document.getElementById('loadingOverlay').classList.remove('active');
    }

    function debounce(func, wait) {
      let timeout;
      return function executedFunction(...args) {
        const later = () => {
          clearTimeout(timeout);
          func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
      };
    }

    function calculateNumerology() {
      const fullName = document.getElementById('fullName').value.trim();
      const day = parseInt(document.getElementById('day').value);
      const month = parseInt(document.getElementById('month').value);
      const year = parseInt(document.getElementById('year').value);
      const resultDiv = document.getElementById('result');
      const summaryDiv = document.getElementById('summary');
      const detailsDiv = document.getElementById('details');
      const calculationDetailsDiv = document.getElementById('calculationDetails');
      const meaningsDiv = document.getElementById('meanings');
      const calculateBtn = document.getElementById('calculateBtn');
      const showMoreBtn = document.getElementById('showMoreBtn');
      const showCalcBtn = document.getElementById('showCalcBtn');
      const showMeaningsBtn = document.getElementById('showMeaningsBtn');

      if (!fullName || !/^[a-zA-Z\s]*$/.test(fullName)) {
        summaryDiv.innerHTML = '<p class="text-red-500 font-medium">Họ tên chỉ được chứa chữ cái và khoảng trắng!</p>';
        hideLoading();
        return;
      }
      if (!isValidDate(day, month, year)) {
        summaryDiv.innerHTML = '<p class="text-red-500 font-medium">Ngày sinh không hợp lệ!</p>';
        hideLoading();
        return;
      }

      calculateBtn.disabled = true;
      showLoading();
      setTimeout(() => {
        const dateSum = String(day).split('').reduce((sum, digit) => sum + Number(digit), 0) + String(month).split('').reduce((sum, digit) => sum + Number(digit), 0) + String(year).split('').reduce((sum, digit) => sum + Number(digit), 0);
        const lifePathNumber = reduceToSingleDigit(dateSum);
        let soulUrgeSum = 0, personalitySum = 0;
        const letters = fullName.split('');
        for (let i = 0; i < letters.length; i++) {
          const letter = letters[i];
          if (/[a-zA-Z]/.test(letter)) {
            const prevLetter = i > 0 ? letters[i - 1] : null;
            const nextLetter = i < letters.length - 1 ? letters[i + 1] : null;
            const value = getLetterValue(letter);
            if (isVowel(letter, prevLetter, nextLetter)) soulUrgeSum += value;
            else personalitySum += value;
          }
        }
        const soulUrgeNumber = reduceToSingleDigit(soulUrgeSum);
        const personalityNumber = reduceToSingleDigit(personalitySum);
        const additionalNumbers = calculateAdditionalNumbers(fullName, day, month, year, lifePathNumber);
        summaryDiv.innerHTML = `<h2 class="text-lg sm:text-xl font-semibold text-purple-800 dark:text-purple-200">Kết Quả Tổng Quan</h2><p><strong>Họ và tên:</strong> ${fullName}</p><p><strong>Ngày sinh:</strong> ${day}/${month}/${year}</p><p><strong>Con số chủ đạo (Số đường đời):</strong> ${lifePathNumber}</p><p><strong>Con số linh hồn:</strong> ${soulUrgeNumber}</p><p><strong>Con số nhân cách:</strong> ${personalityNumber}</p><p><strong>Con số tương tác:</strong> ${additionalNumbers.expressionNumber}</p><p><strong>Con số linh hồn ẩn:</strong> ${additionalNumbers.hiddenPassionNumber}</p><p><strong>Con số ngày sinh:</strong> ${additionalNumbers.birthDayNumber}</p><p><strong>Con số thách thức 1:</strong> ${additionalNumbers.challenge1}</p><p><strong>Con số thách thức 2:</strong> ${additionalNumbers.challenge2}</p><p><strong>Con số thách thức 3:</strong> ${additionalNumbers.challenge3}</p><p><strong>Con số thách thức 4:</strong> ${additionalNumbers.challenge4}</p>`;
        detailsDiv.innerHTML = `<h2 class="text-lg sm:text-xl font-semibold text-purple-800 dark:text-purple-200">Chi Tiết Thần Số Học</h2><p><strong>Con số chủ đạo (Số đường đời):</strong> ${lifePathNumber} - ${getLifePathMeaning(lifePathNumber)}</p><p><strong>Con số linh hồn:</strong> ${soulUrgeNumber} - ${getLifePathMeaning(soulUrgeNumber)}</p><p><strong>Con số nhân cách:</strong> ${personalityNumber} - ${getLifePathMeaning(personalityNumber)}</p><p><strong>Con số tương tác (Số biểu đạt):</strong> ${additionalNumbers.expressionNumber} - ${getLifePathMeaning(additionalNumbers.expressionNumber)}</p><p><strong>Con số linh hồn ẩn (Số đam mê ẩn):</strong> ${additionalNumbers.hiddenPassionNumber} - ${getLifePathMeaning(additionalNumbers.hiddenPassionNumber)}</p><p><strong>Con số ngày sinh:</strong> ${additionalNumbers.birthDayNumber} - ${getLifePathMeaning(additionalNumbers.birthDayNumber)}</p><p><strong>Con số thách thức 1:</strong> ${additionalNumbers.challenge1} - ${getChallengeMeaning(additionalNumbers.challenge1)}</p><p><strong>Con số thách thức 2:</strong> ${additionalNumbers.challenge2} - ${getChallengeMeaning(additionalNumbers.challenge2)}</p><p><strong>Con số thách thức 3:</strong> ${additionalNumbers.challenge3} - ${getChallengeMeaning(additionalNumbers.challenge3)}</p><p><strong>Con số thách thức 4:</strong> ${additionalNumbers.challenge4} - ${getChallengeMeaning(additionalNumbers.challenge4)}</p>`;
        const calcDetails = `
          <h2 class="text-lg sm:text-xl font-semibold text-purple-800 dark:text-purple-200">Cách Tính Chi Tiết</h2>
          <p><strong>Con số chủ đạo (Số đường đời):</strong> Cộng tất cả các chữ số trong ngày sinh, tháng sinh và năm sinh, sau đó rút gọn về một chữ số (trừ 11, 22).</p>
          <p><strong>Con số linh hồn:</strong> Tổng giá trị các nguyên âm (A=1, E=5, I=9, O=6, U=3, đôi khi Y=7) trong họ tên đầy đủ, rút gọn về một chữ số.</p>
          <p><strong>Con số nhân cách:</strong> Tổng giá trị các phụ âm trong họ tên đầy đủ, rút gọn về một chữ số.</p>
          <p><strong>Con số tương tác (Số biểu đạt):</strong> Tổng giá trị tất cả chữ cái trong họ tên, rút gọn về một chữ số.</p>
          <p><strong>Con số linh hồn ẩn (Số đam mê ẩn):</strong> Con số chữ cái xuất hiện nhiều nhất trong họ tên (dựa trên giá trị số học).</p>
          <p><strong>Con số ngày sinh:</strong> Rút gọn ngày sinh về một chữ số.</p>
          <p><strong>Con số thách thức:</strong> Tính dựa trên sự chênh lệch giữa con số chủ đạo và các con số khác (ngày sinh, biểu đạt, tháng, năm), rút gọn.</p>
        `;
        calculationDetailsDiv.innerHTML = calcDetails;
        let meaningsHTML = '<h2 class="text-lg sm:text-xl font-semibold text-purple-800 dark:text-purple-200">Ý Nghĩa Các Con Số Trong Kết Quả</h2>';
        meaningsHTML += '<p class="mb-2">Trong thần số học, mỗi con số mang ý nghĩa riêng, phản ánh các khía cạnh khác nhau của cuộc sống và tính cách của bạn. Dưới đây là giải thích chi tiết về ý nghĩa của từng loại con số trong kết quả của bạn.</p>';
        meaningsHTML += '<h3 class="font-semibold mt-4">Ý Nghĩa Các Con Số</h3><ul class="list-disc pl-5 space-y-2">';
        meaningsHTML += `<li><strong>Con số chủ đạo (Số đường đời - Số 5):</strong> Đây là con số quan trọng nhất trong thần số học, được tính bằng cách cộng tất cả các chữ số trong ngày sinh của bạn và rút gọn về một chữ số (trừ 11 hoặc 22). Nó đại diện cho con đường cuộc đời, sứ mệnh và bài học chính mà bạn sẽ trải qua trong suốt cuộc sống. Với số 5, bạn có xu hướng yêu thích tự do, phiêu lưu và linh hoạt. <strong>Ý nghĩa:</strong> ${getLifePathMeaning(5)}</li>`;
        meaningsHTML += `<li><strong>Con số linh hồn (Số 6):</strong> Con số này được tính từ tổng giá trị các nguyên âm trong họ tên đầy đủ, phản ánh mong muốn nội tâm, động lực sâu xa và điều bạn khao khát trong tâm hồn. Với số 6, bạn có xu hướng hướng tới trách nhiệm, gia đình và sự yêu thương. <strong>Ý nghĩa:</strong> ${getLifePathMeaning(6)}</li>`;
        meaningsHTML += `<li><strong>Con số nhân cách (Số 2):</strong> Được tính từ tổng giá trị các phụ âm trong họ tên, con số này thể hiện cách bạn thể hiện bản thân ra bên ngoài, ấn tượng bạn tạo ra với người khác. Với số 2, bạn thường được nhìn nhận là người hòa hợp, nhạy cảm và giỏi hợp tác. <strong>Ý nghĩa:</strong> ${getLifePathMeaning(2)}</li>`;
        meaningsHTML += `<li><strong>Con số tương tác (Số biểu đạt - Số 8):</strong> Là tổng giá trị tất cả các chữ cái trong họ tên, con số này cho biết cách bạn tương tác với thế giới, thể hiện tài năng và mục đích sống. Với số 8, bạn có khả năng đạt thành công lớn trong lĩnh vực tài chính và quyền lực. <strong>Ý nghĩa:</strong> ${getLifePathMeaning(8)}</li>`;
        meaningsHTML += `<li><strong>Con số linh hồn ẩn (Số đam mê ẩn - Số 9):</strong> Là con số xuất hiện nhiều nhất trong các chữ cái của họ tên, thể hiện đam mê tiềm ẩn hoặc năng lượng mạnh mẽ nhất trong bạn. Với số 9, bạn có xu hướng nhân đạo, cống hiến và hướng tới việc giúp đỡ người khác. <strong>Ý nghĩa:</strong> ${getLifePathMeaning(9)}</li>`;
        meaningsHTML += `<li><strong>Con số ngày sinh (Số 5):</strong> Được rút gọn từ ngày sinh, con số này phản ánh năng lượng đặc trưng của bạn vào ngày sinh ra, ảnh hưởng đến cách bạn hành động trong cuộc sống. Với số 5, bạn mang năng lượng tự do, thích khám phá và thay đổi. <strong>Ý nghĩa:</strong> ${getLifePathMeaning(5)}</li>`;
        meaningsHTML += '</ul>';
        meaningsHTML += '<h3 class="font-semibold mt-4">Ý Nghĩa Các Con Số Thách Thức</h3><p class="mb-2">Con số thách thức thể hiện những bài học hoặc khó khăn bạn cần vượt qua trong cuộc đời, được tính dựa trên sự chênh lệch giữa con số chủ đạo và các con số khác.</p><ul class="list-disc pl-5 space-y-2">';
        meaningsHTML += `<li><strong>Con số thách thức 1 (Số 0):</strong> Không có thách thức cụ thể, nhưng bạn cần tập trung vào bài học của con số chủ đạo (số 5). <strong>Ý nghĩa:</strong> ${getChallengeMeaning(0)}</li>`;
        meaningsHTML += `<li><strong>Con số thách thức 2 và 4 (Số 3):</strong> Thách thức này yêu cầu bạn tập trung và phát triển kỷ luật để vượt qua sự phân tâm. <strong>Ý nghĩa:</strong> ${getChallengeMeaning(3)}</li>`;
        meaningsHTML += `<li><strong>Con số thách thức 3 (Số 4):</strong> Thách thức này liên quan đến việc cân bằng giữa sự ổn định và khả năng thích nghi với thay đổi. <strong>Ý nghĩa:</strong> ${getChallengeMeaning(4)}</li>`;
        meaningsHTML += '</ul>';
        meaningsDiv.innerHTML = meaningsHTML;
        showMoreBtn.classList.remove('hidden');
        showCalcBtn.classList.remove('hidden');
        showMeaningsBtn.classList.remove('hidden');
        detailsDiv.classList.remove('details-shown');
        detailsDiv.classList.add('details-hidden');
        calculationDetailsDiv.classList.remove('details-shown');
        calculationDetailsDiv.classList.add('details-hidden');
        meaningsDiv.classList.remove('details-shown');
        meaningsDiv.classList.add('details-hidden');
        saveInputs(fullName, day, month, year);
        calculateBtn.disabled = false;
        hideLoading();
      }, 500);
    }

    document.addEventListener('DOMContentLoaded', () => {
      populateDropdowns();
      loadInputs();
    });

    const themeToggle = document.getElementById('themeToggle');
    const themeIcon = document.getElementById('themeIcon');
    themeToggle.addEventListener('click', () => {
      document.documentElement.classList.toggle('dark');
      if (document.documentElement.classList.contains('dark')) {
        themeIcon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>';
      } else {
        themeIcon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>';
      }
    });

    const showMoreBtn = document.getElementById('showMoreBtn');
    const detailsDiv = document.getElementById('details');
    showMoreBtn.addEventListener('click', () => {
      detailsDiv.classList.toggle('details-hidden');
      detailsDiv.classList.toggle('details-shown');
      showMoreBtn.textContent = detailsDiv.classList.contains('details-shown') ? 'Ẩn Chi Tiết' : 'Xem Thêm';
    });

    const showCalcBtn = document.getElementById('showCalcBtn');
    const calculationDetailsDiv = document.getElementById('calculationDetails');
    showCalcBtn.addEventListener('click', () => {
      calculationDetailsDiv.classList.toggle('details-hidden');
      calculationDetailsDiv.classList.toggle('details-shown');
      showCalcBtn.textContent = calculationDetailsDiv.classList.contains('details-shown') ? 'Ẩn Cách Tính' : 'Xem Cách Tính';
    });

    const showMeaningsBtn = document.getElementById('showMeaningsBtn');
    const meaningsDiv = document.getElementById('meanings');
    showMeaningsBtn.addEventListener('click', () => {
      meaningsDiv.classList.toggle('details-hidden');
      meaningsDiv.classList.toggle('details-shown');
      showMeaningsBtn.textContent = meaningsDiv.classList.contains('details-shown') ? 'Ẩn Ý Nghĩa' : 'Xem Ý Nghĩa Các Con Số';
    });

    const clearBtn = document.getElementById('clearBtn');
    clearBtn.addEventListener('click', () => {
      document.getElementById('fullName').value = '';
      document.getElementById('day').value = '';
      document.getElementById('month').value = '';
      document.getElementById('year').value = '';
      document.getElementById('summary').innerHTML = '';
      document.getElementById('details').innerHTML = '';
      document.getElementById('calculationDetails').innerHTML = '';
      document.getElementById('meanings').innerHTML = '';
      document.getElementById('showMoreBtn').classList.add('hidden');
      document.getElementById('showCalcBtn').classList.add('hidden');
      document.getElementById('showMeaningsBtn').classList.add('hidden');
    });

    const calculateBtn = document.getElementById('calculateBtn');
    const debouncedCalculate = debounce(calculateNumerology, 500);
    calculateBtn.addEventListener('click', debouncedCalculate);
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') debouncedCalculate();
    });
  </script>
</body>
</html>
